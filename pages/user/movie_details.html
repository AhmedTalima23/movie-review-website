<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - MovieReview</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <!-- <link rel="stylesheet" href="../../assets/css/navbar.css"> -->
    <link rel="stylesheet" href="../../assets/css/movie_details_css.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <h1><a href="home.html">Movie<span>Review</span></a></h1>
                <ul>
                    <li><a href="home.html" class="active">Home</a></li>
                    <li><a href="movie_list.html">Browse Movies</a></li>
                    <li><a href="my_reviews.html">My Reviews</a></li>
                    <li><a href="profile.html">Profile</a></li>
                    <li><a href="../auth/logout.html">Logout</a></li>
                </ul>
                <div class="bar-icon">☰</div>
            </div>
        </div>
    </nav>

    <!-- THE SHAWSHANK REDEMPTION -->
    <section class="movie-section">
        <div class="container">
            <div class="movie-header">
                <img src="../../assets/img/movies/shaw.jpg" alt="The Shawshank Redemption">
                <div class="movie-info">
                    <h2>The Shawshank Redemption</h2>
                    <p class="movie-meta">Drama | 1994 | 142 mins</p>
                    <p class="director">Director: Frank Darabont</p>
                    <p class="cast">Cast: Tim Robbins, Morgan Freeman, Bob Gunton</p>
                    <div class="rating">★★★★★ <span class="rating-value">4.8/5</span></div>
                </div>
            </div>

            <div class="movie-synopsis">
                <h3>Synopsis</h3>
                <p>Two imprisoned men bond over years of hardship, finding solace and redemption through acts of common decency. The film captures the essence of hope and humanity in the darkest of times.</p>
            </div>

            <div class="review-section" data-movie="the-shawshank-redemption">
                <h3>Reviews</h3>
                <div class="review-form">
                    <textarea id="review-shawshank" placeholder="Write your review..."></textarea>
                    <button class="btn" onclick="submitReview('the-shawshank-redemption')">Submit Review</button>
                </div>
                <div class="reviews" id="reviews-shawshank">
                    <div class="review">
                        <div class="review-header">
                            <span class="reviewer">John Doe</span>
                            <span class="review-rating">★★★★★</span>
                        </div>
                        <p>An unforgettable film that redefines hope. Truly timeless storytelling and performances.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- THE DARK KNIGHT -->
    <section class="movie-section">
        <div class="container">
            <div class="movie-header">
                <img src="../../assets/img/movies/the dark night.jpg" alt="The Dark Knight">
                <div class="movie-info">
                    <h2>The Dark Knight</h2>
                    <p class="movie-meta">Action, Crime, Drama | 2008 | 152 mins</p>
                    <p class="director">Director: Christopher Nolan</p>
                    <p class="cast">Cast: Christian Bale, Heath Ledger, Aaron Eckhart</p>
                    <div class="rating">★★★★★ <span class="rating-value">4.9/5</span></div>
                </div>
            </div>

            <div class="movie-synopsis">
                <h3>Synopsis</h3>
                <p>Batman faces the Joker, a criminal mastermind who pushes Gotham to its moral limits. A gritty, intense exploration of chaos, justice, and the thin line between hero and vigilante.</p>
            </div>

            <div class="review-section" data-movie="the-dark-knight">
                <h3>Reviews</h3>
                <div class="review-form">
                    <textarea id="review-darkknight" placeholder="Write your review..."></textarea>
                    <button class="btn" onclick="submitReview('the-dark-knight')">Submit Review</button>
                </div>
                <div class="reviews" id="reviews-darkknight">
                    <div class="review">
                        <div class="review-header">
                            <span class="reviewer">Sarah Lee</span>
                            <span class="review-rating">★★★★★</span>
                        </div>
                        <p>Heath Ledger's Joker is one of the best performances ever. A dark, brilliant masterpiece that changed superhero films forever.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- THE GODFATHER -->
    <section class="movie-section">
        <div class="container">
            <div class="movie-header">
                <img src="../../assets/img/movies/The Godfather.jpg" alt="The Godfather">
                <div class="movie-info">
                    <h2>The Godfather</h2>
                    <p class="movie-meta">Crime, Drama | 1972 | 175 mins</p>
                    <p class="director">Director: Francis Ford Coppola</p>
                    <p class="cast">Cast: Marlon Brando, Al Pacino, James Caan</p>
                    <div class="rating">★★★★★ <span class="rating-value">4.9/5</span></div>
                </div>
            </div>

            <div class="movie-synopsis">
                <h3>Synopsis</h3>
                <p>The aging patriarch of an organized crime dynasty transfers control of his empire to his reluctant son. A stunning exploration of family, loyalty, and power in the world of the mafia.</p>
            </div>

            <div class="review-section" data-movie="the-godfather">
                <h3>Reviews</h3>
                <div class="review-form">
                    <textarea id="review-godfather" placeholder="Write your review..."></textarea>
                    <button class="btn" onclick="submitReview('the-godfather')">Submit Review</button>
                </div>
                <div class="reviews" id="reviews-godfather">
                    <div class="review">
                        <div class="review-header">
                            <span class="reviewer">Michael Rossi</span>
                            <span class="review-rating">★★★★★</span>
                        </div>
                        <p>An absolute classic. Every scene is legendary. The Godfather defines cinema excellence and storytelling perfection.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 MovieReview. All rights reserved.</p>
            <p>Discover, Review, and Rate your favorite movies.</p>
        </div>
    </footer>

    <script>
        // Function to get reviews from local storage
        function getReviews(movieId) {
            const reviews = localStorage.getItem(`reviews_${movieId}`);
            return reviews ? JSON.parse(reviews) : [];
        }

        // Function to save reviews to local storage
        function saveReviews(movieId, reviews) {
            localStorage.setItem(`reviews_${movieId}`, JSON.stringify(reviews));
        }

        // Function to get current user name (you can modify this later to get from user session)
        function getCurrentUser() {
            // Check if user is logged in and get their name from localStorage
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    return user.name || user.username || 'Anonymous User';
                } catch (e) {
                    return 'Anonymous User';
                }
            }
            return 'Anonymous User';
        }

        // Mapping movie IDs to textarea and container IDs
        const movieIdMap = {
            'the-shawshank-redemption': { textarea: 'review-shawshank', container: 'reviews-shawshank' },
            'the-dark-knight': { textarea: 'review-darkknight', container: 'reviews-darkknight' },
            'the-godfather': { textarea: 'review-godfather', container: 'reviews-godfather' }
        };

        // Function to submit a review
        function submitReview(movieId) {
            const ids = movieIdMap[movieId];
            if (!ids) {
                console.error('Invalid movie ID:', movieId);
                return;
            }

            const textarea = document.getElementById(ids.textarea);
            const reviewText = textarea.value.trim();

            if (!reviewText) {
                alert('Please write a review before submitting.');
                return;
            }

            // Get existing reviews
            const reviews = getReviews(movieId);

            // Create new review object
            const newReview = {
                id: Date.now(), // Unique ID based on timestamp
                movieId: movieId, // Store movie ID with review
                user: getCurrentUser(),
                text: reviewText,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            };

            // Add new review to array
            reviews.push(newReview);

            // Save to local storage
            saveReviews(movieId, reviews);

            // Clear textarea
            textarea.value = '';

            // Reload and display reviews
            displayReviews(movieId);
        }

        // Function to display reviews
        function displayReviews(movieId) {
            const ids = movieIdMap[movieId];
            if (!ids) {
                console.error('Invalid movie ID:', movieId);
                return;
            }

            const reviewsContainer = document.getElementById(ids.container);
            const reviews = getReviews(movieId);

            // Clear existing user-submitted reviews (keep the first hardcoded review if it exists)
            const existingReviews = reviewsContainer.querySelectorAll('.review.user-submitted');
            existingReviews.forEach(review => review.remove());

            // Add all saved reviews
            reviews.forEach(review => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review user-submitted';
                reviewDiv.innerHTML = `
                    <div class="review-header">
                        <span class="reviewer">${review.user}</span>
                        <span class="review-date">${review.date} ${review.time}</span>
                    </div>
                    <p>${review.text}</p>
                `;
                reviewsContainer.appendChild(reviewDiv);
            });
        }

        // Load and display all reviews when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load reviews for each movie
            displayReviews('the-shawshank-redemption');
            displayReviews('the-dark-knight');
            displayReviews('the-godfather');
        });
    </script>
</body>
</html>
